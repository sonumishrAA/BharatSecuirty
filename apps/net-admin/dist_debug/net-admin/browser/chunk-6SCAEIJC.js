import{f as u}from"./chunk-YBAUDIUZ.js";import{a as c}from"./chunk-GY5U62TY.js";import{b as g}from"./chunk-RT5UYCHB.js";import{B as o,O as n,R as h,Va as l,W as a,Yb as s,n as r}from"./chunk-V2IGFCHU.js";var K=(()=>{class i{constructor(t,e){this.http=t,this.router=e,this.API_URL=`${c.apiUrl}/auth`,this.TOKEN_KEY="cms_token",this.USER_KEY="cms_user",this.userSignal=l(this.loadUserFromStorage()),this.loadingSignal=l(!1),this.user=s(()=>this.userSignal()),this.isAuthenticated=s(()=>!!this.userSignal()),this.isAdmin=s(()=>this.userSignal()?.role==="admin"),this.loading=s(()=>this.loadingSignal()),this.verifySession()}login(t){return this.loadingSignal.set(!0),this.http.post(`${this.API_URL}/login`,t).pipe(n(e=>{this.saveSession(e),this.loadingSignal.set(!1)}),o(e=>(this.loadingSignal.set(!1),console.error("Login failed:",e),r(null))))}logout(t=!0){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.userSignal.set(null),t&&this.router.navigate(["/login"])}getCurrentUser(){return this.http.get(`${this.API_URL}/me`).pipe(n(t=>this.userSignal.set(t)),o(()=>(this.logout(!1),r(null))))}getToken(){return localStorage.getItem(this.TOKEN_KEY)}verifySession(){this.getToken()&&this.getCurrentUser().subscribe()}saveSession(t){localStorage.setItem(this.TOKEN_KEY,t.token),localStorage.setItem(this.USER_KEY,JSON.stringify(t.user)),this.userSignal.set(t.user)}loadUserFromStorage(){let t=localStorage.getItem(this.USER_KEY);return t?JSON.parse(t):null}static{this.\u0275fac=function(e){return new(e||i)(a(g),a(u))}}static{this.\u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();export{K as a};
